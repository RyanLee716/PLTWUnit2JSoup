/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function(factory){typeof define==='function'&&define.amd?define(factory):factory();})((function(){'use strict';class HeaderUserMenu{setup(){window.CommonKit.Util.waitFor(()=>{this.setupElements();this.setupMenu();this.setupMobileMenu();},()=>document.getElementById('header-user-menu'));}setupElements(){this.menu=document.getElementById('header-user-menu');}setupMenu(){this.rootItem=this.menu.querySelector('.menu-item--my-account');if(this.rootItem)this.rootItemMenuLinks=this.rootItem.querySelectorAll('.menu-item--depth-2 li > a');else{this.menuItemLogin=this.menu.querySelector('.menu-item--login a');if(this.menuItemLogin)this.setupMenuLoginDestination();}}setupMobileMenu(){const options={weight:-100,callback:(menu)=>{const userMenu=menu.querySelector('.mobile-header-user-menu');userMenu.classList.add('header-user-menu');if(this.rootItem){const myAccount=userMenu.querySelector('.menu-item--my-account');const wrapper=document.createElement('div');wrapper.classList.add('header-user-menu-group');myAccount.after(wrapper);wrapper.appendChild(myAccount);const accountItems=userMenu.querySelectorAll('.menu-item--account-group');accountItems.forEach((item)=>{wrapper.appendChild(item);});const avatar=myAccount.querySelector('.avatar');if(avatar){const avatarID=`${avatar.firstElementChild.id}-2`;avatar.firstElementChild.id=avatarID;if(window.drupalSettings.commonKit&&window.drupalSettings.commonKit.avatar)window.drupalSettings.commonKit.avatar.selectors[avatarID]=1;window.CS.PageState.triggerUpdate('avatar-subscribe');}}else{const menuItemLogin=userMenu.querySelector('.menu-item--login a');if(menuItemLogin)menuItemLogin.classList.add('btn','btn--neutral','btn--block');}}};CS.HeaderMobileMenu.MobileMenu.addMenu(this.menu,options);window.CS.PageState.triggerUpdate('header-menu-mobile',{},'user');if(window.CS.PageState.getStateType('avatar-subscribe'))window.CS.PageState.triggerUpdate('avatar-subscribe');}setupMenuLoginDestination(){const {path}=drupalSettings;if(path.currentQuery&&path.currentQuery.destination)this.menuItemLogin.href+=`?destination=${path.currentQuery.destination}`;else{const skipPaths=['user/login','user/password','user/register','homepage'];const isSkipPath=skipPaths.find((skipPath)=>skipPath===path.currentPath);if(!isSkipPath)this.menuItemLogin.href+=`?destination=/${path.pathPrefix}${path.currentPath}`;}}static init(){const headerUserMenu=new HeaderUserMenu();headerUserMenu.setup();}}HeaderUserMenu.init();}));;
